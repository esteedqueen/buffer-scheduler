#! /usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'
require 'dotenv'
Dotenv.load

require 'hbs_content'
require 'buffer'

require_relative '../lib/buffer_schedule'

HbsContent.configure(:contentful,
  access_token: ENV['CONTENTFUL_ACCESS_TOKEN'],
  space: ENV['CONTENTFUL_SPACE_ID']
)

buffer_client = Buffer::Client.new(ENV['BUFFER_ACCESS_TOKEN'])

advertisements = HbsContent::ListOfTweets.advertisement.tweets.map(&:text)
random_contents = HbsContent::ListOfTweets.internal_content.tweets.map(&:text)

puts random_contents.class
puts random_contents.count
buffer_schedule = BufferSchedule.new(buffer_client)

if buffer_schedule.is_empty?
  buffer_schedule.update(advertisements.concat(random_contents))
  buffer_schedule.shuffle
  puts "buffer_schedule updated and shuffled"
else
  puts "There are tweets in the buffer_schedule"
end

