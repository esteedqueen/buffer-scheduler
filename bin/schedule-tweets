#! /usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'
require 'dotenv'
Dotenv.load

require 'hbs_content'
require 'buffer'

require_relative '../lib/buffer_schedule'

# Disable Hashie warning "You are setting a key that conflicts with a built-in method" flooding the logs in buffer api gem
Hashie.logger = Logger.new(nil)

HbsContent.configure(:contentful,
  access_token: ENV['CONTENTFUL_ACCESS_TOKEN'],
  space: ENV['CONTENTFUL_SPACE_ID']
)

buffer_client = Buffer::Client.new(ENV['BUFFER_ACCESS_TOKEN'])
twitter_username = ENV['TWITTER_USERNAME']

advertisements = HbsContent::ListOfTweets.advertisement.tweets.map(&:text)
random_contents = HbsContent::ListOfTweets.internal_content.tweets.map(&:text).shuffle.take(6)

buffer_schedule = BufferSchedule.new(buffer_client, twitter_username)

ScheduleTweetsRunner.new.run(buffer_schedule, advertisements.concat(random_contents))
